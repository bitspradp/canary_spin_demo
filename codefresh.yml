version: '1.0'
steps:
  buildTheImage:
    type: build
    description: Builds my service
    image_name: otomato/ornithology
    tag: ${{CF_SHORT_REVISION}}
  pushTheImage:
    type: push
    candidate: ${{build-the-image}}
    tag: ${{CF_SHORT_REVISION}}
  deployToK8s:
    title: deploy-to-k8s
    image: codefresh/k8s-kubectl
    commands:
      - sed -i -- "s/BUILD_NUMBER/${{CF_SHORT_REVISION}}/g" orni-dep.yml
      - kubectl config use-context cf-staging@codefresh-staging
      - kubectl apply -f orni-dep.yml -n otom8
